import{_ as C,u as G,r as c,i as B,h as v,o as r,c as u,F as h,P as x,S as y,Y as A,b as a,j as N,a as k,Q as I,f,d as L,X as j,w as H,e as w,U as O,g as P}from"./app.f2be09e0.js";import{a as Q,A as X}from"./AppUsersTables.45de4b05.js";import{A as Y}from"./AppLoader.cac3a6e6.js";import{A as q}from"./AppEditor.2acf2cc4.js";import{A as z}from"./AppHeader.111e5057.js";const J={name:"AppRaceColumn",props:["raceId"],emits:["update"],setup(s,{emit:e}){const _=G(),t=c([]),m=c(0);return B(async()=>{const i=await v.get(`/api/admin/race/${s.raceId}`);t.value=i.data,m.value=Object.keys(t.value).length+1}),{submit:async()=>{try{await v.post(`/api/admin/race/${s.raceId}/results`,{result:t.value}),_.dispatch("notification/displayMessage",{value:"\u0414\u0430\u043D\u043D\u044B\u0435 \u0433\u043E\u043D\u043A\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B",type:"primary"}),e("update")}catch{_.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0433\u043E\u043D\u043A\u0438",type:"error"})}},result:t,userAmount:m}}},K=["onUpdate:modelValue","placeholder"],W={class:"race-table__item race-table__result"};function Z(s,e,_,t,m,b){return r(),u(h,null,[(r(!0),u(h,null,x(t.result,(i,o)=>(r(),u("div",{class:"race-table__item race-table__result",key:o},[y(a("input",{type:"text","onUpdate:modelValue":n=>t.result[o]=n,placeholder:`(dnf, ${t.userAmount})`},null,8,K),[[A,t.result[o]]])]))),128)),a("div",W,[a("button",{onClick:e[0]||(e[0]=(...i)=>t.submit&&t.submit(...i))},"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])],64)}const $=C(J,[["render",Z]]),tt={name:"AppRaceTable",props:["stageId","status","groupId"],components:{AppRaceColumn:$},setup(s){const e=c({}),_=c({}),t=c(),m=c(),b=c({default:"\u0413\u043E\u043D\u043A\u0430",group:"\u0413\u0440\u0443\u043F\u043F\u0430",fleet:"\u0424\u043B\u043E\u0442"}),i=N(()=>{var d;return(d=Object.keys(e.value).length)!=null?d:0}),o=async()=>{try{const d=await v.get(`/api/admin/stage/${s.stageId}/${s.groupId}/${s.status}/total`);m.value=d.data}catch(d){console.log(d.message)}};return B(async()=>{try{const d=await v.get(`/api/admin/stage/${s.stageId}/races/${s.status}/group/${s.groupId}`);e.value=d.data,t.value=e.value[0].race_id;const g=await v.get(`/api/admin/race/${t.value}/users`);_.value=g.data,console.log("usersData",_.value),await o()}catch(d){console.log(d.message)}}),{raceData:e,raceAmount:i,usersData:_,addRace:async()=>{try{const g=(await v.post("/api/admin/race/create",{stage_id:s.stageId,group_id:s.groupId,status:s.status,lastRaceId:t.value})).data;e.value.push({race_id:g.id,group_id:g.group_id,status:g.status}),await o()}catch(d){console.log(d.message)}},remove:async d=>{try{await v.post(`/api/admin/race/${d}/remove`),e.value.splice(e.value.findIndex(g=>g.race_id===d),1),await o()}catch(g){console.log(g.message)}},totalData:m,getTotal:o,raceTitle:b}}},et={class:"race-table"},at={key:0},st={class:"race-table__header"},ot={class:"race-table__row"},rt=a("div",{class:"race-table__item race-table__name"},"\u042F\u0445\u0442\u0441\u043C\u0435\u043D",-1),nt=a("div",{class:"race-table__item race-table__total"},"\u0418\u0442\u043E\u0433",-1),lt={class:"race-table__body"},ct={class:"race-table__column"},it={key:0,class:"race-table__item race-table__result"},dt=["onClick"],ut={class:"race-table__column"};function _t(s,e,_,t,m,b){const i=k("AppRaceColumn");return r(),u("div",et,[s.$props.status?(r(),u("h2",at,I(t.raceTitle[s.$props.status])+" #"+I(s.$props.groupId),1)):f("",!0),a("button",{class:"btn btn-default btn-settings mb15",onClick:e[0]||(e[0]=(...o)=>t.addRace&&t.addRace(...o))},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0433\u043E\u043D\u043A\u0443"),a("div",st,[a("div",ot,[rt,(r(!0),u(h,null,x(t.raceAmount,o=>(r(),u("div",{class:"race-table__item race-table__result",key:o},"#"+I(o),1))),128)),nt])]),a("div",lt,[a("div",ct,[(r(!0),u(h,null,x(t.usersData,o=>(r(),u("div",{class:"race-table__item race-table__name",key:o.user_id},I(o.nickname),1))),128))]),(r(!0),u(h,null,x(t.raceData,(o,n)=>(r(),u("div",{class:"race-table__column",key:o.race_id},[L(i,{raceId:o.race_id,onUpdate:t.getTotal},null,8,["raceId","onUpdate"]),t.raceData.length>1&&n+1!==1?(r(),u("div",it,[a("button",{onClick:S=>t.remove(o.race_id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,dt)])):f("",!0)]))),128)),a("div",ut,[(r(!0),u(h,null,x(t.totalData,(o,n)=>(r(),u("div",{class:"race-table__item race-table__total",key:n},I(o),1))),128))])])])}const pt=C(tt,[["render",_t]]),mt={name:"TheStageStatus",emits:["update"],props:["status","id"],setup(s,{emit:e}){const _=c(s.status),t=s.id,m=G();return{status:_,startStage:async()=>{try{const n=await v.post(`/api/admin/stage/${t}/start`);_.value=n.data.status,e("update",_.value)}catch(n){console.log(n.message),m.dispatch("notification/displayMessage",{value:n.response.data.message,type:"error"})}},finishGroupStage:async()=>{try{const n=await v.post(`/api/admin/stage/${t}/finish-group`);_.value=n.data.status,e("update",_.value)}catch(n){console.log(n.message),m.dispatch("notification/displayMessage",{value:n.response.data.message,type:"error"})}},id:t,finishStage:async()=>{try{const n=await v.post(`/api/admin/stage/${t}/finish`);_.value=n.data.status,e("update",_.value)}catch(n){console.log(n.message),m.dispatch("notification/displayMessage",{value:n.response.data.message,type:"error"})}}}}};function gt(s,e,_,t,m,b){return r(),u(h,null,[t.status==="active"?(r(),u("button",{key:0,class:"btn btn-default btn-settings mb30",onClick:e[0]||(e[0]=(...i)=>t.startStage&&t.startStage(...i))},"\u041D\u0430\u0447\u0430\u0442\u044C \u044D\u0442\u0430\u043F")):f("",!0),t.status==="group"?(r(),u("button",{key:1,class:"btn btn-default btn-settings mb30",onClick:e[1]||(e[1]=(...i)=>t.finishGroupStage&&t.finishGroupStage(...i))},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u043E\u0432\u043E\u0439 \u044D\u0442\u0430\u043F")):f("",!0),t.status==="default"||t.status==="fleet"?(r(),u("button",{key:2,class:"btn btn-default btn-settings mb30",onClick:e[2]||(e[2]=(...i)=>t.finishStage&&t.finishStage(...i))},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0440\u0435\u0433\u0430\u0442\u0443")):f("",!0)],64)}const vt=C(mt,[["render",gt]]),ft={name:"stage.edit",components:{AppUsersTables:Q,AppRaceTable:pt,TheStageStatus:vt,AppResultTable:X,AppLoader:Y,AppEditor:q,AppHeader:z},setup(){const s=c(!1),e=j(),_=G(),t=e.params.id,m=c(),b=c(""),i=c(""),o=c(""),n=c(""),S=c(""),d=c(""),g=c(),R=c(),l=c(),U=c(),V=c(),T=c(null),E=c(),D=c(),F=async p=>{try{const M=await v.get(`/api/admin/stage/${t}/meta`);E.value=M.data,R.value=p,D.value&&D.value.update()}catch(M){console.log(M.message)}};return B(async()=>{s.value=!0;try{const p=await v.get(`/api/admin/stage/${t}/edit`);n.value=m.value=p.data.title,b.value=p.data.register_start,i.value=p.data.register_end,o.value=p.data.race_start,S.value=p.data.excerpt?p.data.excerpt:" ",d.value=p.data.description?p.data.description:" ",g.value=p.data.users,l.value=p.data.race_amount_drop,U.value=p.data.race_amount_group_drop,V.value=p.data.race_amount_fleet_drop,await F(p.data.status),s.value=!1}catch(p){console.log(p.message),s.value=!1}}),{register_start:b,register_end:i,race_start:o,title:n,excerpt:S,description:d,submit:async()=>{s.value=!0;try{if(await v.patch(`/api/admin/stage/${t}/update`,{title:n.value,description:d.value,excerpt:S.value,register_start:b.value,register_end:i.value,race_start:o.value,race_amount_drop:l.value,race_amount_group_drop:U.value,race_amount_fleet_drop:V.value}),T.value)for(let p of T.value)p.getTotal();_.dispatch("notification/displayMessage",{value:"\u042D\u0442\u0430\u043F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D",type:"primary"}),s.value=!1}catch(p){console.log(p.message),_.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u044D\u0442\u0430\u043F\u0430",type:"error"}),s.value=!1}},users:g,status:R,id:t,statusGroup:E,child:T,race_amount_drop:l,race_amount_group_drop:U,race_amount_fleet_drop:V,statusGroupFetch:F,resultComponent:D,h1:m,loading:s}}},bt={class:"container-fluid g-0"},ht={class:"row"},yt={class:"col-12"},At={class:"dashboard-item"},kt={class:"form-control"},St=a("label",{for:"register_start"},"\u041D\u0430\u0447\u0430\u043B\u043E \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),wt={class:"form-control"},xt=a("label",{for:"register_end"},"\u041A\u043E\u043D\u0435\u0446 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),Tt={class:"form-control"},It=a("label",{for:"race_start"},"\u041D\u0430\u0447\u0430\u043B\u043E \u0433\u043E\u043D\u043E\u043A",-1),Ut={class:"form-control"},Vt=a("label",{for:"title"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u042D\u0442\u0430\u043F\u0430",-1),Rt={class:"form-control"},Ct=a("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)",-1),Dt={class:"form-control"},Mt=a("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),Gt={class:"form-control"},Bt=a("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),Et={class:"form-control"},Ft=a("label",{for:"excerpt"},"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),Lt={class:"form-control"},Nt=a("label",{for:"description"},"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),jt=a("button",{class:"btn btn-default btn-settings"},"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",-1),Ht={class:"col-12"},Ot={class:"dashboard-item"};function Pt(s,e,_,t,m,b){const i=k("AppHeader"),o=k("AppLoader"),n=k("AppEditor"),S=k("AppUsersTables"),d=k("AppRaceTable"),g=k("TheStageStatus"),R=k("AppResultTable");return r(),u(h,null,[L(i,null,{default:H(()=>[P(I(t.h1),1)]),_:1}),a("main",null,[a("div",bt,[a("div",ht,[a("div",yt,[a("div",At,[t.loading?(r(),w(o,{key:0})):f("",!0),a("form",{onSubmit:e[9]||(e[9]=O((...l)=>t.submit&&t.submit(...l),["prevent"]))},[a("div",kt,[St,y(a("input",{class:"form-input",type:"datetime-local",id:"register_start","onUpdate:modelValue":e[0]||(e[0]=l=>t.register_start=l)},null,512),[[A,t.register_start]])]),a("div",wt,[xt,y(a("input",{class:"form-input",type:"datetime-local",id:"register_end","onUpdate:modelValue":e[1]||(e[1]=l=>t.register_end=l)},null,512),[[A,t.register_end]])]),a("div",Tt,[It,y(a("input",{class:"form-input",type:"datetime-local",id:"race_start","onUpdate:modelValue":e[2]||(e[2]=l=>t.race_start=l)},null,512),[[A,t.race_start]])]),a("div",Ut,[Vt,y(a("input",{class:"form-input",type:"text",id:"title","onUpdate:modelValue":e[3]||(e[3]=l=>t.title=l),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u044D\u0442\u0430\u043F\u0430"},null,512),[[A,t.title]])]),a("div",Rt,[Ct,y(a("input",{class:"form-input",type:"text",id:"race_amount_drop","onUpdate:modelValue":e[4]||(e[4]=l=>t.race_amount_drop=l),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[A,t.race_amount_drop]])]),a("div",Dt,[Mt,y(a("input",{class:"form-input",type:"text",id:"race_amount_group_drop","onUpdate:modelValue":e[5]||(e[5]=l=>t.race_amount_group_drop=l),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[A,t.race_amount_group_drop]])]),a("div",Gt,[Bt,y(a("input",{class:"form-input",type:"text",id:"race_amount_fleet_drop","onUpdate:modelValue":e[6]||(e[6]=l=>t.race_amount_fleet_drop=l),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[A,t.race_amount_fleet_drop]])]),a("div",Et,[Ft,t.excerpt?(r(),w(n,{key:0,modelValue:t.excerpt,"onUpdate:modelValue":e[7]||(e[7]=l=>t.excerpt=l),id:"excerpt"},null,8,["modelValue"])):f("",!0)]),a("div",Lt,[Nt,t.description?(r(),w(n,{key:0,modelValue:t.description,"onUpdate:modelValue":e[8]||(e[8]=l=>t.description=l),id:"description"},null,8,["modelValue"])):f("",!0)]),jt],32)])]),a("div",Ht,[a("div",Ot,[t.status==="active"&&t.users?(r(),w(S,{key:0,users:t.users},null,8,["users"])):f("",!0),t.status!=="finished"&&t.status!=="active"?(r(!0),u(h,{key:1},x(t.statusGroup,(l,U,V)=>(r(),u("div",{class:"stage-table",key:V},[(r(!0),u(h,null,x(l,T=>(r(),w(d,{stageId:t.id,groupId:T,status:U,key:T,ref_for:!0,ref:"child"},null,8,["stageId","groupId","status"]))),128))]))),128)):f("",!0),t.status?(r(),w(g,{key:2,status:t.status,id:t.id,onUpdate:t.statusGroupFetch},null,8,["status","id","onUpdate"])):f("",!0),t.status!=="active"?(r(),w(R,{key:3,id:t.id,ref:"resultComponent"},null,8,["id"])):f("",!0)])])])])])],64)}const Kt=C(ft,[["render",Pt]]);export{Kt as default};
