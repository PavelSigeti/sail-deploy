import{_ as k,u as T,r as p,o,c as l,b as s,S as $,Y as q,V,Q as r,g as y,U as D,F as b,P as I,f as h,h as f,i as L,a as g,e as w,d as A,G as R,w as F}from"./app.96a8ec99.js";import{A as B}from"./logo.597c877d.js";import{t as N}from"./time.025744ef.js";import{A as j}from"./AppHeader.a25215d2.js";const H={name:"TheUserSearchForm",props:["team_id"],emits:["invite","load"],setup(c,{emit:t}){const d=T(),e=p(),_=p(null),m=p(null),a=p(!1);return{search:async()=>{if(a.value===!0){e.value="",a.value=!1;return}if(e.value.length>0){const n=await f.post("/api/user/search",{user:e.value});n.data.length>0?(_.value=n.data,a.value=!0):_.value=null}else _.value=null},searchCandidates:_,user:e,invite:async()=>{try{if(t("load"),m.value){const n=await f.post("/api/team-invite",{team_id:c.team_id,user_id:m.value.id});m.value=null,d.dispatch("notification/displayMessage",{value:"\u041F\u0440\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E",type:"primary"}),t("invite",n.data),t("load")}else d.dispatch("notification/displayMessage",{value:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",type:"error"}),t("load")}catch(n){console.log(n.message),d.dispatch("notification/displayMessage",{value:n.response.data.message,type:"error"}),t("load")}},selected:m,selectUser:n=>{e.value="",a.value=!1,_.value=null,m.value=n},displaySearch:a}}},E={key:0,class:"user-item"},z={class:"user-item__content"},G={class:"user-item__btn"},P={key:1,class:"user-item"},Q={class:"user-item__content"},Y={class:"user-item__nickname"},Z={class:"user-item__id"},J={class:"user-item__name"},K={key:2,class:"search-container"},O=["onClick"],W={class:"search-candidate__nickname"},X={class:"search-candidate__id"},ee={class:"search-candidate__name"};function te(c,t,d,e,_,m){return o(),l("form",{class:"invite-form",onSubmit:t[6]||(t[6]=D(()=>{},["prevent"]))},[e.selected?(o(),l("div",P,[s("div",Q,[s("div",Y,[y(r(e.selected.nickname)+" ",1),s("span",Z,"#"+r(e.selected.id),1)]),s("div",J,r(e.selected.surname)+" "+r(e.selected.name),1),s("div",{class:"user-item__cancel",onClick:t[3]||(t[3]=a=>e.selected=null)},"\u0423\u0431\u0440\u0430\u0442\u044C")]),s("div",{class:"user-item__invite",onClick:t[5]||(t[5]=a=>e.selected=null)},[s("button",{onClick:t[4]||(t[4]=D((...a)=>e.invite&&e.invite(...a),["prevent"])),class:"btn btn-default btn-team"},"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u044C")])])):(o(),l("div",E,[s("div",z,[$(s("input",{class:"form-input__user-search",type:"text",id:"user","onUpdate:modelValue":t[0]||(t[0]=a=>e.user=a),onInput:t[1]||(t[1]=a=>e.displaySearch=!1),placeholder:"\u041D\u0430\u0439\u0442\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",autocomplete:"off"},null,544),[[q,e.user]])]),s("div",G,[s("div",{onClick:t[2]||(t[2]=(...a)=>e.search&&e.search(...a)),class:V(["btn","btn-team",{"btn-default":!e.displaySearch,"btn-border":e.displaySearch}])},r(e.displaySearch?"\u041E\u0442\u0447\u0438\u0441\u0442\u0438\u0442\u044C":"\u041D\u0430\u0439\u0442\u0438"),3)])])),e.searchCandidates&&e.user.length>0&&e.displaySearch?(o(),l("div",K,[(o(!0),l(b,null,I(e.searchCandidates,a=>(o(),l("div",{class:"search-candidate",key:a.id,onClick:i=>e.selectUser(a)},[s("div",W,[y(r(a.nickname)+" ",1),s("span",X,"#"+r(a.id),1)]),s("div",ee,r(a.surname)+" "+r(a.name),1)],8,O))),128))])):h("",!0)],32)}const se=k(H,[["render",te]]),ae={name:"AppTeamInvite",props:["invites","load"],setup(c,{emit:t}){const d=p(c.invites),e=T();return{invites:d,rejectInvite:async(a,i)=>{t("load");try{await f.delete(`/api/team-invite/${a}/delete`),d.value.splice(i,1),e.dispatch("notification/displayMessage",{value:"\u041F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u0435 \u043E\u0442\u043A\u043B\u043E\u043D\u0435\u043D\u043E",type:"primary"}),t("load")}catch{t("load"),e.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043A\u043B\u043E\u043D\u0435\u043D\u0438\u0438 \u043F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u044F",type:"error"})}},acceptInvite:async a=>{t("load");try{await f.post(`/api/team-invite/${a}/accept`),d.value=[],e.dispatch("notification/displayMessage",{value:"\u0412\u044B \u0432\u0441\u0442\u0443\u043F\u0438\u043B\u0438 \u0432 \u043A\u043E\u043C\u0430\u043D\u0434\u0443",type:"primary"}),t("update"),t("load")}catch(i){console.log(i.message),e.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0438 \u0432 \u043A\u043E\u043C\u0430\u043D\u0434\u0443",type:"error"}),t("load")}}}}},ne={class:"team-invites"},oe=s("h3",null,"\u041F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u044F \u0432 \u043A\u043E\u043C\u0430\u043D\u0434\u0443",-1),ie={class:"team-invite__item-name"},le={class:"b500"},ce={class:"team-invite__buttons"},re=["onClick"],de=["onClick"];function _e(c,t,d,e,_,m){return o(),l("div",ne,[oe,(o(!0),l(b,null,I(e.invites,(a,i)=>(o(),l("div",{class:"team-invite__item",key:a.id},[s("div",ie,[y(" \u041A\u043E\u043C\u0430\u043D\u0434\u0430: "),s("span",le,r(a.name),1)]),s("div",ce,[s("div",{class:"btn btn-default btn-team btn-accept",onClick:v=>e.acceptInvite(a.id)}," \u041F\u0440\u0438\u043D\u044F\u0442\u044C ",8,re),s("div",{class:"btn btn-border btn-team btn-cancel",onClick:v=>e.rejectInvite(a.id,i)}," \u041E\u0442\u043A\u0437\u0430\u0442\u044C\u0441\u044F ",8,de)])]))),128))])}const me=k(ae,[["render",_e]]),ve={name:"AppConfirmation",emits:["close","confirmation"],props:["question"],setup(c){return{question:p(c.question)}}},ue={class:"modal"},pe={class:"modal-container"};function he(c,t,d,e,_,m){return o(),l("div",ue,[s("div",{class:"modal-background",onClick:t[0]||(t[0]=a=>c.$emit("close"))}),s("div",pe,[s("h3",null,r(e.question),1),s("div",{class:"btn btn-cancel btn-border btn-full-width mb15",onClick:t[1]||(t[1]=a=>c.$emit("confirmation"))},"\u0414\u0430"),s("div",{class:"btn btn-accept btn-default btn-full-width",onClick:t[2]||(t[2]=a=>c.$emit("close"))},"\u041D\u0435\u0442")])])}const ge=k(ve,[["render",he]]),fe="/build/assets/crown.cd3f701d.svg",ye={name:"TheTeamSettings",components:{AppUserSearchForm:se,AppTeamInvite:me,AppLoader:B,AppConfirmation:ge},setup(){const c=T(),t=p(),d=p(),e=p(),_=p(!1),m=p([]),a=p(),i=p(!1),v=p(!1),x=()=>{i.value=!i.value},n=async()=>{i.value=!0;try{const u=await f.get("/api/team/edit");d.value=u.data.team,e.value=u.data.invites,_.value=u.data.owner,m.value=u.data.teammates,a.value=u.data.teamInvites}catch(u){console.log(u.message)}i.value=!1};return L(async()=>{await n()}),{name:t,team:d,submit:async()=>{i.value=!0;try{await f.post("/api/team/store",{name:t.value}),await n()}catch(u){u.response.status===422?c.dispatch("notification/displayMessage",{value:"\u0422\u0430\u043A\u043E\u0435 \u0438\u043C\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u044B \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442",type:"error"}):console.log(u.message)}i.value=!1},owner:_,addInvite:u=>{a.value.push(u)},teamInvites:a,cancelInvite:async(u,M)=>{i.value=!0;try{await f.delete(`/api/team-invite/${u}/delete`),a.value.splice(M,1),c.dispatch("notification/displayMessage",{value:"\u041F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u0435 \u043E\u0442\u043C\u0435\u043D\u0435\u043D\u043E",type:"primary"})}catch(C){console.log(C.message),c.dispatch("notification/displayMessage",{value:C.message,type:"error"})}i.value=!1},teammates:m,invites:e,getData:n,removeTeammate:async(u,M)=>{i.value=!0;try{await f.post("/api/user/remove-teammate",{id:u}),u===null?await n():m.value.splice(M,1),c.dispatch("notification/displayMessage",{value:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u043F\u043E\u043A\u0438\u043D\u0443\u043B \u043A\u043E\u043C\u0430\u043D\u0434\u0443",type:"primary"}),v.value=!1}catch(C){console.log(C.message),c.dispatch("notification/displayMessage",{value:C.response.data.message,type:"error"})}i.value=!1},deleteTeam:async()=>{i.value=!0;try{await f.delete("/api/team/delete"),c.dispatch("notification/displayMessage",{value:"\u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u0440\u0430\u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u0430!",type:"primary"}),await n()}catch(u){console.log(u.message),c.dispatch("notification/displayMessage",{value:u.response.data.message,type:"error"})}v.value=!1,i.value=!1},loading:i,toggleLoad:x,leaveConfirm:v}}},be={class:"dashboard-item"},ke=s("h3",null,"\u041A\u043E\u043C\u0430\u043D\u0434\u0430",-1),we={key:1,class:"content-block"},Ce={class:"b500"},Ae={class:"teammate-container"},Ie={class:"user-item__content"},xe={class:"user-item__nickname"},Se={class:"user-item__id"},Te={class:"user-item__name"},Me={key:0,class:"user-item__icon"},De=s("img",{src:fe,alt:"crown"},null,-1),Le=[De],Ue=["onClick"],$e=s("div",{class:"btn btn-border btn-team btn-cancel"},"\u0418\u0441\u043A\u043B\u044E\u0447\u0438\u0442\u044C",-1),qe=[$e],Ve={key:2,class:"content-block"},Fe=s("p",null,"\u0412\u044B \u043D\u0435 \u0441\u043E\u0441\u0442\u043E\u0438\u0442\u0435 \u0432 \u043A\u043E\u043C\u0430\u043D\u0434\u0435 :(",-1),Be={class:"form-control"},Re=s("label",{for:"name"},"\u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0441\u0432\u043E\u044E \u043A\u043E\u043C\u0430\u043D\u0434\u0443",-1),Ne=s("button",{class:"btn btn-default btn-full-width"},"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443",-1),je={key:3,class:"team-invites"},He={class:"user-item__content"},Ee={class:"user-item__nickname"},ze={class:"user-item__id"},Ge={class:"user-item__name"},Pe=["onClick"],Qe=s("div",{class:"btn btn-border btn-team btn-cancel"},"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C",-1),Ye=[Qe],Ze={key:0,class:"dashboard-item"};function Je(c,t,d,e,_,m){const a=g("AppLoader"),i=g("AppUserSearchForm"),v=g("AppConfirmation"),x=g("AppTeamInvite");return o(),l(b,null,[s("div",be,[e.loading?(o(),w(a,{key:0})):h("",!0),ke,e.team?(o(),l("div",we,[s("p",null,[y("\u0412\u0430\u0448\u0430 \u043A\u043E\u043C\u0430\u043D\u0434\u0430: "),s("span",Ce,r(e.team.name),1)]),s("div",Ae,[(o(!0),l(b,null,I(e.teammates,(n,S)=>(o(),l("div",{class:"user-item",key:n.id},[s("div",Ie,[s("div",xe,[y(r(n.nickname)+" ",1),s("span",Se,"#"+r(n.id),1)]),s("div",Te,r(n.surname)+" "+r(n.name),1)]),e.team.owner_id===n.id?(o(),l("div",Me,Le)):h("",!0),e.owner&&e.team.owner_id!==n.id?(o(),l("div",{key:1,class:"user-item__btn user-item__cancel-btn",onClick:U=>e.removeTeammate(n.id,S)},qe,8,Ue)):h("",!0)]))),128))])])):(o(),l("div",Ve,[Fe,s("form",{onSubmit:t[1]||(t[1]=D((...n)=>e.submit&&e.submit(...n),["prevent"]))},[s("div",Be,[Re,$(s("input",{class:"form-input",id:"name",type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>e.name=n),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u043E\u043C\u0430\u043D\u0434\u044B"},null,512),[[q,e.name]])]),Ne],32)])),e.teamInvites&&e.teamInvites.length>0?(o(),l("div",je,[(o(!0),l(b,null,I(e.teamInvites,(n,S)=>(o(),l("div",{class:"user-item",key:n.id},[s("div",He,[s("div",Ee,[y(r(n.nickname)+" ",1),s("span",ze,"#"+r(n.user_id),1)]),s("div",Ge,r(n.surname)+" "+r(n.name),1)]),s("div",{class:"user-item__btn",onClick:U=>e.cancelInvite(n.id,S)},Ye,8,Pe)]))),128))])):h("",!0),e.owner&&e.teamInvites&&e.teammates&&e.teamInvites.length<3-e.teammates.length?(o(),w(i,{key:4,team_id:e.team.id,onInvite:e.addInvite,onLoad:e.toggleLoad},null,8,["team_id","onInvite","onLoad"])):h("",!0),e.owner?(o(),l("button",{key:5,class:"btn btn-border btn-full-width",onClick:t[2]||(t[2]=n=>e.leaveConfirm=!0)},"\u0420\u0430\u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443")):h("",!0),e.owner&&e.leaveConfirm?(o(),w(v,{key:6,onConfirmation:e.deleteTeam,onClose:t[3]||(t[3]=n=>e.leaveConfirm=!1),question:"\u0420\u0430\u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443?"},null,8,["onConfirmation"])):h("",!0),!e.owner&&e.team?(o(),l("button",{key:7,class:"btn btn-border btn-full-width",onClick:t[4]||(t[4]=n=>e.leaveConfirm=!0)}," \u041F\u043E\u043A\u0438\u043D\u0443\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443 ")):h("",!0),!e.owner&&e.leaveConfirm?(o(),w(v,{key:8,onConfirmation:t[5]||(t[5]=n=>e.removeTeammate(null,null)),onClose:t[6]||(t[6]=n=>e.leaveConfirm=!1),question:"\u041F\u043E\u043A\u0438\u043D\u0443\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443?"})):h("",!0)]),e.invites&&e.invites.length>0?(o(),l("div",Ze,[A(x,{invites:e.invites,onUpdate:e.getData,onLoad:e.toggleLoad},null,8,["invites","onUpdate","onLoad"])])):h("",!0)],64)}const Ke=k(ye,[["render",Je]]),Oe={name:"AppDashStages",components:{AppLoader:B},props:["stage"],setup(c){const t=()=>{const v=new Date().toLocaleString("ru-RU",{timeZone:"Europe/Moscow"}).split(",");m.value=`${v[0]} ${v[1]}`},d=T(),e=p(c.stage),_=p(!1),m=p();L(()=>{t()});const a=setInterval(t,1e3);return R(()=>{clearInterval(a)}),{stage:e,loading:_,time:N,toggleReg:async()=>{_.value=!0;try{e.value.users_exists?(await axios.post(`/api/stage/${e.value.id}/cancel`),e.value.users_exists=!1,d.dispatch("notification/displayMessage",{value:"\u0412\u044B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0442\u043A\u0430\u0437\u0430\u043B\u0438\u0441\u044C \u043E\u0442 \u0443\u0447\u0430\u0441\u0442\u0438\u0435 \u0432 \u0440\u0435\u0433\u0430\u0442\u0435",type:"primary"})):(await axios.post(`/api/stage/${e.value.id}/accept`),e.value.users_exists=!0,d.dispatch("notification/displayMessage",{value:"\u0412\u044B \u0437\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u043D\u0430 \u0440\u0435\u0433\u0430\u0442\u0443",type:"primary"}))}catch(v){console.log(v.message),d.dispatch("notification/displayMessage",{value:v.response.data.message,type:"error"})}_.value=!1},now:m}}},We={class:"dash-stage"},Xe={class:"dash-stage__header"},et={class:"dash-stage__tournament"},tt={key:0,class:"user-stage__participant"},st={class:"dash-stage__date"},at={key:1,class:"btn btn-disable btn-settings-280"},nt={key:2,class:"btn btn-disable btn-settings-280"},ot={key:4,class:"btn btn-disable btn-settings-280"};function it(c,t,d,e,_,m){const a=g("AppLoader"),i=g("router-link");return o(),l("div",We,[e.loading?(o(),w(a,{key:0})):h("",!0),s("div",Xe,[A(i,{to:`/dashboard/stage/${e.stage.id}`,class:"dash-stage__title"},{default:F(()=>[y(r(e.stage.title),1)]),_:1},8,["to"]),s("div",et,r(e.stage.tournament),1),e.stage.users_exists?(o(),l("div",tt,"\u0412\u044B \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442\u0435")):h("",!0)]),s("div",st,[s("span",null,"\u041D\u0430\u0447\u0430\u043B\u043E \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438: "+r(e.time(e.stage.register_start)),1),s("span",null,"\u041E\u043A\u043E\u043D\u0447\u0430\u043D\u0438\u0435 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438: "+r(e.time(e.stage.register_end)),1),s("span",null,"\u041D\u0430\u0447\u0430\u043B\u043E \u0433\u043E\u043D\u043E\u043A: "+r(e.time(e.stage.race_start)),1)]),e.time(e.stage.register_start)>e.now?(o(),l("div",at," \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F \u043D\u0435 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C ")):e.time(e.stage.race_start)<e.now&&e.stage.status!=="finished"?(o(),l("div",nt," \u0420\u0435\u0433\u0430\u0442\u0430 \u043F\u0440\u043E\u0445\u043E\u0434\u0438\u0442 ")):e.stage.status==="active"&&e.time(e.stage.register_end)>e.now?(o(),l("div",{key:3,class:V(["btn","btn-settings-280",{"btn-default":!e.stage.users_exists},{"btn-border":e.stage.users_exists}]),onClick:t[0]||(t[0]=(...v)=>e.toggleReg&&e.toggleReg(...v))},r(e.stage.users_exists?"\u041E\u0442\u043A\u0430\u0437\u0430\u0442\u044C\u0441\u044F \u043E\u0442 \u0443\u0447\u0430\u0441\u0442\u0438\u044F":"\u041F\u0440\u0438\u043D\u044F\u0442\u044C \u0443\u0447\u0430\u0441\u0442\u0438\u0435"),3)):(o(),l("div",ot,"\u041E\u0436\u0438\u0434\u0430\u0439\u0442\u0435"))])}const lt=k(Oe,[["render",it]]),ct={name:"AppDashActualStages",components:{AppDashStages:lt},setup(){const c=p();return L(async()=>{try{const t=await axios.get("/api/stage/actual/dashboard");c.value=t.data}catch(t){console.log(t.message)}}),{stages:c}}};function rt(c,t,d,e,_,m){const a=g("AppDashStages");return o(!0),l(b,null,I(e.stages,i=>(o(),w(a,{key:i.id,stage:i},null,8,["stage"]))),128)}const dt=k(ct,[["render",rt]]),_t={name:"Dashboard",components:{TheTeamSettings:Ke,AppDashActualStages:dt,AppHeader:j},setup(){return{}}},mt={class:"container-fluid g-0"},vt={class:"row"},ut={class:"col-lg-6 col-xl-5 col-xxl-4"},pt={class:"col-lg-6 col-xl-7 col-xxl-8"},ht={class:"dashboard-item"},gt=s("h3",null,"\u0410\u043A\u0442\u0443\u0430\u043B\u044C\u043D\u044B\u0435 \u0433\u043E\u043D\u043A\u0438",-1),ft={class:"dash-stage__container"};function yt(c,t,d,e,_,m){const a=g("AppHeader"),i=g("TheTeamSettings"),v=g("AppDashActualStages");return o(),l(b,null,[A(a,null,{default:F(()=>[y("\u041B\u0438\u0447\u043D\u044B\u0439 \u043A\u0430\u0431\u0438\u043D\u0435\u0442")]),_:1}),s("main",null,[s("div",mt,[s("div",vt,[s("div",ut,[A(i)]),s("div",pt,[s("div",ht,[gt,s("div",ft,[A(v)])])])])])])],64)}const St=k(_t,[["render",yt]]);export{St as default};
