import{_ as w,u as M,r as p,o as n,c as i,b as s,S as U,Y as $,g as b,Q as r,U as q,F as k,P as T,f as g,h as y,i as D,a as f,e as C,d as I,G as B,w as V,V as R}from"./app.f2be09e0.js";import{A as F}from"./AppLoader.cac3a6e6.js";import{t as N}from"./time.025744ef.js";import{A as j}from"./AppHeader.111e5057.js";const H={name:"TheUserSearchForm",props:["team_id"],emits:["invite","load"],setup(c,{emit:t}){const d=M(),e=p(),_=p(null),m=p(null);return{search:async()=>{if(e.value.length>0){const h=await y.post("/api/user/search",{user:e.value});h.data.length>0?_.value=h.data:_.value=null}else _.value=null},searchCandidates:_,user:e,invite:async()=>{try{if(t("load"),m.value){const h=await y.post("/api/team-invite",{team_id:c.team_id,user_id:m.value.id});m.value=null,d.dispatch("notification/displayMessage",{value:"\u041F\u0440\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E",type:"primary"}),t("invite",h.data),t("load")}else d.dispatch("notification/displayMessage",{value:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",type:"error"}),t("load")}catch(h){console.log(h.message),d.dispatch("notification/displayMessage",{value:h.response.data.message,type:"error"}),t("load")}},selected:m,selectUser:h=>{e.value="",_.value=null,m.value=h}}}},E={class:"invite-form"},z={key:0,class:"user-item"},G={class:"user-item__content"},P=s("div",{class:"user-item__btn"},[s("div",{class:"btn btn-default btn-team"},"\u041D\u0430\u0439\u0442\u0438")],-1),Q={key:1,class:"user-item"},Y={class:"user-item__content"},Z={class:"user-item__nickname"},J={class:"user-item__id"},K={class:"user-item__name"},O={key:2,class:"search-container"},W=["onClick"],X={class:"search-candidate__nickname"},ee={class:"search-candidate__id"},te={class:"search-candidate__name"};function se(c,t,d,e,_,m){return n(),i("form",E,[e.selected?(n(),i("div",Q,[s("div",Y,[s("div",Z,[b(r(e.selected.nickname)+" ",1),s("span",J,"#"+r(e.selected.id),1)]),s("div",K,r(e.selected.surname)+" "+r(e.selected.name),1),s("div",{class:"user-item__cancel",onClick:t[2]||(t[2]=a=>e.selected=null)},"\u0423\u0431\u0440\u0430\u0442\u044C")]),s("div",{class:"user-item__invite",onClick:t[4]||(t[4]=a=>e.selected=null)},[s("button",{onClick:t[3]||(t[3]=q((...a)=>e.invite&&e.invite(...a),["prevent"])),class:"btn btn-default btn-team"},"\u041F\u0440\u0438\u0433\u043B\u0430\u0441\u0438\u0442\u044C")])])):(n(),i("div",z,[s("div",G,[U(s("input",{class:"form-input__user-search",type:"text",id:"user","onUpdate:modelValue":t[0]||(t[0]=a=>e.user=a),onInput:t[1]||(t[1]=(...a)=>e.search&&e.search(...a)),placeholder:"\u041D\u0430\u0439\u0442\u0438 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F",autocomplete:"off"},null,544),[[$,e.user]])]),P])),e.searchCandidates&&e.user.length>0?(n(),i("div",O,[(n(!0),i(k,null,T(e.searchCandidates,a=>(n(),i("div",{class:"search-candidate",key:a.id,onClick:o=>e.selectUser(a)},[s("div",X,[b(r(a.nickname)+" ",1),s("span",ee,"#"+r(a.id),1)]),s("div",te,r(a.surname)+" "+r(a.name),1)],8,W))),128))])):g("",!0)])}const ae=w(H,[["render",se]]),ne={name:"AppTeamInvite",props:["invites","load"],setup(c,{emit:t}){const d=p(c.invites),e=M();return{invites:d,rejectInvite:async(a,o)=>{t("load");try{await y.delete(`/api/team-invite/${a}/delete`),d.value.splice(o,1),e.dispatch("notification/displayMessage",{value:"\u041F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u0435 \u043E\u0442\u043A\u043B\u043E\u043D\u0435\u043D\u043E",type:"primary"}),t("load")}catch{t("load"),e.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043A\u043B\u043E\u043D\u0435\u043D\u0438\u0438 \u043F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u044F",type:"error"})}},acceptInvite:async a=>{t("load");try{await y.post(`/api/team-invite/${a}/accept`),d.value=[],e.dispatch("notification/displayMessage",{value:"\u0412\u044B \u0432\u0441\u0442\u0443\u043F\u0438\u043B\u0438 \u0432 \u043A\u043E\u043C\u0430\u043D\u0434\u0443",type:"primary"}),t("update"),t("load")}catch(o){console.log(o.message),e.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0432\u0441\u0442\u0443\u043F\u043B\u0435\u043D\u0438\u0438 \u0432 \u043A\u043E\u043C\u0430\u043D\u0434\u0443",type:"error"}),t("load")}}}}},oe={class:"team-invites"},ie=s("h3",null,"\u041F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u044F \u0432 \u043A\u043E\u043C\u0430\u043D\u0434\u0443",-1),le={class:"team-invite__item-name"},ce={class:"b500"},re={class:"team-invite__buttons"},de=["onClick"],_e=["onClick"];function me(c,t,d,e,_,m){return n(),i("div",oe,[ie,(n(!0),i(k,null,T(e.invites,(a,o)=>(n(),i("div",{class:"team-invite__item",key:a.id},[s("div",le,[b(" \u041A\u043E\u043C\u0430\u043D\u0434\u0430: "),s("span",ce,r(a.name),1)]),s("div",re,[s("div",{class:"btn btn-default btn-team btn-accept",onClick:v=>e.acceptInvite(a.id)}," \u041F\u0440\u0438\u043D\u044F\u0442\u044C ",8,de),s("div",{class:"btn btn-border btn-team btn-cancel",onClick:v=>e.rejectInvite(a.id,o)}," \u041E\u0442\u043A\u0437\u0430\u0442\u044C\u0441\u044F ",8,_e)])]))),128))])}const ve=w(ne,[["render",me]]),ue={name:"AppConfirmation",emits:["close","confirmation"],props:["question"],setup(c){return{question:p(c.question)}}},pe={class:"modal"},he={class:"modal-container"};function ge(c,t,d,e,_,m){return n(),i("div",pe,[s("div",{class:"modal-background",onClick:t[0]||(t[0]=a=>c.$emit("close"))}),s("div",he,[s("h3",null,r(e.question),1),s("div",{class:"btn btn-cancel btn-border btn-full-width mb15",onClick:t[1]||(t[1]=a=>c.$emit("confirmation"))},"\u0414\u0430"),s("div",{class:"btn btn-accept btn-default btn-full-width",onClick:t[2]||(t[2]=a=>c.$emit("close"))},"\u041D\u0435\u0442")])])}const fe=w(ue,[["render",ge]]),ye="/build/assets/crown.cd3f701d.svg",be={name:"TheTeamSettings",components:{AppUserSearchForm:ae,AppTeamInvite:ve,AppLoader:F,AppConfirmation:fe},setup(){const c=M(),t=p(),d=p(),e=p(),_=p(!1),m=p([]),a=p(),o=p(!1),v=p(!1),h=()=>{o.value=!o.value},l=async()=>{o.value=!0;try{const u=await y.get("/api/team/edit");d.value=u.data.team,e.value=u.data.invites,_.value=u.data.owner,m.value=u.data.teammates,a.value=u.data.teamInvites}catch(u){console.log(u.message)}o.value=!1};return D(async()=>{await l()}),{name:t,team:d,submit:async()=>{o.value=!0;try{await y.post("/api/team/store",{name:t.value}),await l()}catch(u){u.response.status===422?c.dispatch("notification/displayMessage",{value:"\u0422\u0430\u043A\u043E\u0435 \u0438\u043C\u044F \u043A\u043E\u043C\u0430\u043D\u0434\u044B \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442",type:"error"}):console.log(u.message)}o.value=!1},owner:_,addInvite:u=>{a.value.push(u)},teamInvites:a,cancelInvite:async(u,S)=>{o.value=!0;try{await y.delete(`/api/team-invite/${u}/delete`),a.value.splice(S,1),c.dispatch("notification/displayMessage",{value:"\u041F\u0440\u0438\u0433\u043B\u0430\u0448\u0435\u043D\u0438\u0435 \u043E\u0442\u043C\u0435\u043D\u0435\u043D\u043E",type:"primary"})}catch(A){console.log(A.message),c.dispatch("notification/displayMessage",{value:A.message,type:"error"})}o.value=!1},teammates:m,invites:e,getData:l,removeTeammate:async(u,S)=>{o.value=!0;try{await y.post("/api/user/remove-teammate",{id:u}),u===null?await l():m.value.splice(S,1),c.dispatch("notification/displayMessage",{value:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u043F\u043E\u043A\u0438\u043D\u0443\u043B \u043A\u043E\u043C\u0430\u043D\u0434\u0443",type:"primary"}),v.value=!1}catch(A){console.log(A.message),c.dispatch("notification/displayMessage",{value:A.response.data.message,type:"error"})}o.value=!1},deleteTeam:async()=>{o.value=!0;try{await y.delete("/api/team/delete"),c.dispatch("notification/displayMessage",{value:"\u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u0440\u0430\u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u0430!",type:"primary"}),await l()}catch(u){console.log(u.message),c.dispatch("notification/displayMessage",{value:u.response.data.message,type:"error"})}v.value=!1,o.value=!1},loading:o,toggleLoad:h,leaveConfirm:v}}},ke={class:"dashboard-item"},we=s("h3",null,"\u041A\u043E\u043C\u0430\u043D\u0434\u0430",-1),Ce={key:1,class:"content-block"},Ae={class:"b500"},Ie={class:"teammate-container"},Te={class:"user-item__content"},xe={class:"user-item__nickname"},Me={class:"user-item__id"},Se={class:"user-item__name"},De={key:0,class:"user-item__icon"},Le=s("img",{src:ye,alt:"crown"},null,-1),Ue=[Le],$e=["onClick"],qe=s("div",{class:"btn btn-border btn-team btn-cancel"},"\u0418\u0441\u043A\u043B\u044E\u0447\u0438\u0442\u044C",-1),Ve=[qe],Fe={key:2,class:"content-block"},Be=s("p",null,"\u0412\u044B \u043D\u0435 \u0441\u043E\u0441\u0442\u043E\u0438\u0442\u0435 \u0432 \u043A\u043E\u043C\u0430\u043D\u0434\u0435 :(",-1),Re={class:"form-control"},Ne=s("label",{for:"name"},"\u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0441\u0432\u043E\u044E \u043A\u043E\u043C\u0430\u043D\u0434\u0443",-1),je=s("button",{class:"btn btn-default btn-full-width"},"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443",-1),He={key:3,class:"team-invites"},Ee={class:"user-item__content"},ze={class:"user-item__nickname"},Ge={class:"user-item__id"},Pe={class:"user-item__name"},Qe=["onClick"],Ye=s("div",{class:"btn btn-border btn-team btn-cancel"},"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C",-1),Ze=[Ye],Je={key:0,class:"dashboard-item"};function Ke(c,t,d,e,_,m){const a=f("AppLoader"),o=f("AppUserSearchForm"),v=f("AppConfirmation"),h=f("AppTeamInvite");return n(),i(k,null,[s("div",ke,[e.loading?(n(),C(a,{key:0})):g("",!0),we,e.team?(n(),i("div",Ce,[s("p",null,[b("\u0412\u0430\u0448\u0430 \u043A\u043E\u043C\u0430\u043D\u0434\u0430: "),s("span",Ae,r(e.team.name),1)]),s("div",Ie,[(n(!0),i(k,null,T(e.teammates,(l,x)=>(n(),i("div",{class:"user-item",key:l.id},[s("div",Te,[s("div",xe,[b(r(l.nickname)+" ",1),s("span",Me,"#"+r(l.id),1)]),s("div",Se,r(l.surname)+" "+r(l.name),1)]),e.team.owner_id===l.id?(n(),i("div",De,Ue)):g("",!0),e.owner&&e.team.owner_id!==l.id?(n(),i("div",{key:1,class:"user-item__btn user-item__cancel-btn",onClick:L=>e.removeTeammate(l.id,x)},Ve,8,$e)):g("",!0)]))),128))])])):(n(),i("div",Fe,[Be,s("form",{onSubmit:t[1]||(t[1]=q((...l)=>e.submit&&e.submit(...l),["prevent"]))},[s("div",Re,[Ne,U(s("input",{class:"form-input",id:"name",type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>e.name=l),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u043E\u043C\u0430\u043D\u0434\u044B"},null,512),[[$,e.name]])]),je],32)])),e.teamInvites&&e.teamInvites.length>0?(n(),i("div",He,[(n(!0),i(k,null,T(e.teamInvites,(l,x)=>(n(),i("div",{class:"user-item",key:l.id},[s("div",Ee,[s("div",ze,[b(r(l.nickname)+" ",1),s("span",Ge,"#"+r(l.user_id),1)]),s("div",Pe,r(l.surname)+" "+r(l.name),1)]),s("div",{class:"user-item__btn",onClick:L=>e.cancelInvite(l.id,x)},Ze,8,Qe)]))),128))])):g("",!0),e.owner&&e.teamInvites&&e.teammates&&e.teamInvites.length<3-e.teammates.length?(n(),C(o,{key:4,team_id:e.team.id,onInvite:e.addInvite,onLoad:e.toggleLoad},null,8,["team_id","onInvite","onLoad"])):g("",!0),e.owner?(n(),i("button",{key:5,class:"btn btn-border btn-full-width",onClick:t[2]||(t[2]=l=>e.leaveConfirm=!0)},"\u0420\u0430\u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443")):g("",!0),e.owner&&e.leaveConfirm?(n(),C(v,{key:6,onConfirmation:e.deleteTeam,onClose:t[3]||(t[3]=l=>e.leaveConfirm=!1),question:"\u0420\u0430\u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443?"},null,8,["onConfirmation"])):g("",!0),!e.owner&&e.team?(n(),i("button",{key:7,class:"btn btn-border btn-full-width",onClick:t[4]||(t[4]=l=>e.leaveConfirm=!0)}," \u041F\u043E\u043A\u0438\u043D\u0443\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443 ")):g("",!0),!e.owner&&e.leaveConfirm?(n(),C(v,{key:8,onConfirmation:t[5]||(t[5]=l=>e.removeTeammate(null,null)),onClose:t[6]||(t[6]=l=>e.leaveConfirm=!1),question:"\u041F\u043E\u043A\u0438\u043D\u0443\u0442\u044C \u043A\u043E\u043C\u0430\u043D\u0434\u0443?"})):g("",!0)]),e.invites&&e.invites.length>0?(n(),i("div",Je,[I(h,{invites:e.invites,onUpdate:e.getData,onLoad:e.toggleLoad},null,8,["invites","onUpdate","onLoad"])])):g("",!0)],64)}const Oe=w(be,[["render",Ke]]),We={name:"AppDashStages",components:{AppLoader:F},props:["stage"],setup(c){const t=()=>{const v=new Date().toLocaleString("ru-RU",{timeZone:"Europe/Moscow"}).split(",");m.value=`${v[0]} ${v[1]}`},d=M(),e=p(c.stage),_=p(!1),m=p();D(()=>{t()});const a=setInterval(t,1e3);return B(()=>{clearInterval(a)}),{stage:e,loading:_,time:N,toggleReg:async()=>{_.value=!0;try{e.value.users_exists?(await axios.post(`/api/stage/${e.value.id}/cancel`),e.value.users_exists=!1,d.dispatch("notification/displayMessage",{value:"\u0412\u044B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0442\u043A\u0430\u0437\u0430\u043B\u0438\u0441\u044C \u043E\u0442 \u0443\u0447\u0430\u0441\u0442\u0438\u0435 \u0432 \u0440\u0435\u0433\u0430\u0442\u0435",type:"primary"})):(await axios.post(`/api/stage/${e.value.id}/accept`),e.value.users_exists=!0,d.dispatch("notification/displayMessage",{value:"\u0412\u044B \u0437\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u043D\u0430 \u0440\u0435\u0433\u0430\u0442\u0443",type:"primary"}))}catch(v){console.log(v.message),d.dispatch("notification/displayMessage",{value:v.response.data.message,type:"error"})}_.value=!1},now:m}}},Xe={class:"dash-stage"},et={class:"dash-stage__header"},tt={class:"dash-stage__tournament"},st={key:0,class:"user-stage__participant"},at={class:"dash-stage__date"},nt={key:1,class:"btn btn-disable btn-settings-280"},ot={key:2,class:"btn btn-disable btn-settings-280"},it={key:4,class:"btn btn-disable btn-settings-280"};function lt(c,t,d,e,_,m){const a=f("AppLoader"),o=f("router-link");return n(),i("div",Xe,[e.loading?(n(),C(a,{key:0})):g("",!0),s("div",et,[I(o,{to:`/dashboard/stage/${e.stage.id}`,class:"dash-stage__title"},{default:V(()=>[b(r(e.stage.title),1)]),_:1},8,["to"]),s("div",tt,r(e.stage.tournament),1),e.stage.users_exists?(n(),i("div",st,"\u0412\u044B \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442\u0435")):g("",!0)]),s("div",at,[s("span",null,"\u041D\u0430\u0447\u0430\u043B\u043E \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438: "+r(e.time(e.stage.register_start)),1),s("span",null,"\u041E\u043A\u043E\u043D\u0447\u0430\u043D\u0438\u0435 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438: "+r(e.time(e.stage.register_end)),1),s("span",null,"\u041D\u0430\u0447\u0430\u043B\u043E \u0433\u043E\u043D\u043E\u043A: "+r(e.time(e.stage.race_start)),1)]),e.time(e.stage.register_start)>e.now?(n(),i("div",nt," \u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044F \u043D\u0435 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C ")):e.time(e.stage.race_start)<e.now&&e.stage.status!=="finished"?(n(),i("div",ot," \u0420\u0435\u0433\u0430\u0442\u0430 \u043F\u0440\u043E\u0445\u043E\u0434\u0438\u0442 ")):e.stage.status==="active"&&e.time(e.stage.register_end)>e.now?(n(),i("div",{key:3,class:R(["btn","btn-settings-280",{"btn-default":!e.stage.users_exists},{"btn-border":e.stage.users_exists}]),onClick:t[0]||(t[0]=(...v)=>e.toggleReg&&e.toggleReg(...v))},r(e.stage.users_exists?"\u041E\u0442\u043A\u0430\u0437\u0430\u0442\u044C\u0441\u044F \u043E\u0442 \u0443\u0447\u0430\u0441\u0442\u0438\u044F":"\u041F\u0440\u0438\u043D\u044F\u0442\u044C \u0443\u0447\u0430\u0441\u0442\u0438\u0435"),3)):(n(),i("div",it,"\u041E\u0436\u0438\u0434\u0430\u0439\u0442\u0435"))])}const ct=w(We,[["render",lt]]),rt={name:"AppDashActualStages",components:{AppDashStages:ct},setup(){const c=p();return D(async()=>{try{const t=await axios.get("/api/stage/actual/dashboard");c.value=t.data}catch(t){console.log(t.message)}}),{stages:c}}};function dt(c,t,d,e,_,m){const a=f("AppDashStages");return n(!0),i(k,null,T(e.stages,o=>(n(),C(a,{key:o.id,stage:o},null,8,["stage"]))),128)}const _t=w(rt,[["render",dt]]),mt={name:"Dashboard",components:{TheTeamSettings:Oe,AppDashActualStages:_t,AppHeader:j},setup(){return{}}},vt={class:"container-fluid g-0"},ut={class:"row"},pt={class:"col-lg-4"},ht={class:"col-lg-8"},gt={class:"dashboard-item"},ft=s("h3",null,"\u0410\u043A\u0442\u0443\u0430\u043B\u044C\u043D\u044B\u0435 \u0433\u043E\u043D\u043A\u0438",-1),yt={class:"dash-stage__container"};function bt(c,t,d,e,_,m){const a=f("AppHeader"),o=f("TheTeamSettings"),v=f("AppDashActualStages");return n(),i(k,null,[I(a,null,{default:V(()=>[b("\u041B\u0438\u0447\u043D\u044B\u0439 \u043A\u0430\u0431\u0438\u043D\u0435\u0442")]),_:1}),s("main",null,[s("div",vt,[s("div",ut,[s("div",pt,[I(o)]),s("div",ht,[s("div",gt,[ft,s("div",yt,[I(v)])])])])])])],64)}const Mt=w(mt,[["render",bt]]);export{Mt as default};
